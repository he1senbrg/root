# Project Mutations

## Quick Navigation

- [Overview](1-overview.md)
- [System Architecture](2-system-architecture.md)
  - [Application Configuration](2.1-application-configuration.md)
- [Database Models](3-database-models.md)
  - [Member Model](3.1-member-model.md)
  - [Attendance Model](3.2-attendance-model.md)
  - [Streak Model](3.3-streak-model.md)
  - [Project Model](3.4-project-model.md)
- [GraphQL API](4-graphql-api.md)
  - [GraphQL Queries](4.1-graphql-queries.md)
    - [Member Queries](4.1.1-member-queries.md)
    - [Attendance Queries](4.1.2-attendance-queries.md)
    - [Streak Queries](4.1.3-streak-queries.md)
    - [Project Queries](4.1.4-project-queries.md)
  - [GraphQL Mutations](4.2-graphql-mutations.md)
    - [Member Mutations](4.2.1-member-mutations.md)
    - [Attendance Mutations](4.2.2-attendance-mutations.md)
    - [Streak Mutations](4.2.3-streak-mutations.md)
    - [Project Mutations](4.2.4-project-mutations.md)
- [Background Tasks](5-background-tasks.md)
  - [Daily Attendance Task](5.1-daily-attendance-task.md)
- [Deployment and CI/CD](6-deployment-and-cicd.md)
  - [GitHub Actions Workflows](6.1-github-actions-workflows.md)
  - [Docker Deployment](6.2-docker-deployment.md)
- [Security Features](7-security-features.md)
  - [HMAC Authentication](7.1-hmac-authentication.md)

## Table of Contents

- [Project Mutations](#project-mutations)
  - [Purpose and Scope](#purpose-and-scope)
  - [Overview](#overview)
  - [Available Mutations](#available-mutations)
    - [setProject Mutation](#setproject-mutation)
      - [Input](#input)
      - [Output](#output)
  - [Implementation Details](#implementation-details)
  - [Database Operations](#database-operations)
  - [Relationships with Other Models](#relationships-with-other-models)
  - [Usage Example](#usage-example)
  - [Error Handling](#error-handling)

# Project Mutations

Relevant source files

* [src/graphql/mutations/project\_mutations.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/project_mutations.rs)
* [src/graphql/queries/member\_queries.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs)
* [src/graphql/queries/project\_queries.rs](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/project_queries.rs)

## Purpose and Scope

This document describes the GraphQL mutations related to projects in the Root system. Project mutations allow for creating and managing project records associated with members. This page covers the available mutations, their inputs, outputs, and implementation details. For information about retrieving project data, see [Project Queries](/amfoss/root/4.1.4-project-queries).

## Overview

Project mutations are part of the Root GraphQL API that enable write operations on the Project data model. These mutations handle the creation of new projects associated with members. The Project model represents work being done by club members and maintains a relationship with the Member model.

Sources: [src/graphql/mutations/project\_mutations.rs1-28](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/project_mutations.rs#L1-L28)

## Available Mutations

Currently, the system provides a single mutation for project management:

| Mutation | Description | Input | Output |
| --- | --- | --- | --- |
| `setProject` | Creates a new project associated with a member | `SetProjectInput` | `Project` |

### setProject Mutation

The `setProject` mutation creates a new project record in the database, linked to a specific member.

#### Input

The mutation requires a `SetProjectInput` object with the following fields:

| Field | Type | Description |
| --- | --- | --- |
| `member_id` | Int | The ID of the member associated with the project |
| `title` | String | The title/name of the project |

#### Output

When successful, the mutation returns the newly created `Project` object with its auto-generated `project_id`.

Sources: [src/graphql/mutations/project\_mutations.rs13-27](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/project_mutations.rs#L13-L27)

## Implementation Details

The `setProject` mutation is implemented in the `ProjectMutations` struct, which is exposed through the GraphQL API. Here's how it works:

1. The mutation receives a `SetProjectInput` object containing the member ID and project title
2. It accesses the database connection pool from the GraphQL context
3. It executes an SQL `INSERT` query to create a new project record
4. The query returns the complete project record, which is then returned to the client

The mutation is annotated with `#[graphql(name = "setProject")]` to specify its name in the GraphQL schema.

Sources: [src/graphql/mutations/project\_mutations.rs11-27](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/project_mutations.rs#L11-L27)

## Database Operations

The `setProject` mutation interacts with the database through SQL queries executed via the SQLx library. The mutation performs the following database operation:

This query:

1. Inserts a new row into the `Project` table
2. Sets the `member_id` and `project_title` columns with values from the input
3. Returns all columns of the newly created project record

It's worth noting that the column name in the SQL query is `project_title`, while the struct field is named `title`. This indicates a mapping between the database schema and the model representation.

Sources: [src/graphql/mutations/project\_mutations.rs19-22](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/project_mutations.rs#L19-L22)

## Relationships with Other Models

Projects have a many-to-one relationship with members. A member can have multiple projects, but each project belongs to exactly one member. This relationship is enforced by the `member_id` foreign key in the `Project` table.

In the GraphQL schema, this relationship is also reflected in the Member type, which has a `projects` field that returns all projects associated with that member.

Sources: [src/graphql/queries/member\_queries.rs85-93](https://github.com/amfoss/root/blob/2b58803d/src/graphql/queries/member_queries.rs#L85-L93)

## Usage Example

Here's an example of how to use the `setProject` mutation:

Successful response:

## Error Handling

The mutation propagates any errors that occur during database operations to the client. Common errors might include:

* Database connection failures
* Constraint violations (e.g., if an invalid `member_id` is provided)
* Unexpected database errors

When an error occurs, it's returned as part of the GraphQL response in the standard GraphQL error format.

Sources: [src/graphql/mutations/project\_mutations.rs13-27](https://github.com/amfoss/root/blob/2b58803d/src/graphql/mutations/project_mutations.rs#L13-L27)